<div id="crop_example-container">
  <script src="{{ STATIC_URL }}admin/opps/images/js/jquery.imgareaselect.pack.js"></script>
  <link href="{{ STATIC_URL }}admin/opps/images/css/imgareaselect-default.css" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
    django.jQuery(function(){
      var check_url = function() {
        var src = "{{ THUMBOR_SERVER }}/unsafe/";
        var l = parseInt(django.jQuery('#imageExample').attr('data-width')/4);
        var r = parseInt(django.jQuery('#imageExample').attr('data-height')/4);
        if (django.jQuery("#id_fit_in").is(':checked')) { src += 'fit-in/'; }
        if (django.jQuery("#id_flip").is(':checked')) { l = '-' + l; }
        if (django.jQuery("#id_flop").is(':checked')) { r = '-' + r; }
        src += l + "x" + r + "/";
        if (django.jQuery("#id_halign").val()) { src += django.jQuery("#id_halign").val() + '/'; }
        if (django.jQuery("#id_valign").val()) { src += django.jQuery("#id_valign").val() + '/'; }
        if (django.jQuery("#id_smart").is(':checked')) { src += 'smart/'; }

        img = django.jQuery("#imageExample").attr('src')
        if (img.split('http').length == 1){
          img = '{{ THUMBOR_MEDIA_URL }}' + img;
        }
        django.jQuery("#crop_example").attr('src', src + img)
      }

      django.jQuery("#id_meta, #id_flip, #id_flop, #id_fit_in, #id_smart, #id_halign, #id_valign").change(function(){
        check_url();
      });
      check_url();

      django.jQuery('img#crop_example').imgAreaSelect({
        handles: true,
        instance: true,
        fadeSpeed: 400,
        x1: django.jQuery("#id_crop_x1").val(),
        x2: django.jQuery("#id_crop_x2").val(),
        y1: django.jQuery("#id_crop_y1").val(),
        y2: django.jQuery("#id_crop_y2").val(),
        onSelectEnd: function (img, selection) {
          if (selection.height == 0 && selection.width == 0) {
            django.jQuery("#id_crop_x1").val(0)
            django.jQuery("#id_crop_x2").val(0)
            django.jQuery("#id_crop_y1").val(0)
            django.jQuery("#id_crop_y2").val(0)
          } else {
            django.jQuery("#id_crop_x1").val(selection.x1)
            django.jQuery("#id_crop_x2").val(selection.x2)
            django.jQuery("#id_crop_y1").val(selection.y1)
            django.jQuery("#id_crop_y2").val(selection.y2)
          }
        }
      });
      django.jQuery(".field-crop_x1").hide()
      django.jQuery(".field-crop_x2").hide()
      django.jQuery(".field-crop_y1").hide()
      django.jQuery(".field-crop_y2").hide()
    });
  </script>
  <img id="crop_example" />
</div>
